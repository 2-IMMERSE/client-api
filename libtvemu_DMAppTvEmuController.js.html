<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: libtvemu/DMAppTvEmuController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: libtvemu/DMAppTvEmuController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/************************************************************************/
/* FILE:                DMAppTvEmuController.js                         */
/* DESCRIPTION:         DMApp TV emulator controller                    */
/* VERSION:             (see git)                                       */
/* DATE:                (see git)                                       */
/* AUTHOR:              Jonathan Rennison &lt;jonathan.rennison@bt.com>    */
/*                                                                      */
/*                      Â© British Telecommunications plc 2018           */
/*                                                                      */
/* Licensed under the Apache License, Version 2.0 (the "License");      */
/* you may not use this file except in compliance with the License.     */
/* You may obtain a copy of the License at                              */
/*                                                                      */
/*   http://www.apache.org/licenses/LICENSE-2.0                         */
/*                                                                      */
/* Unless required by applicable law or agreed to in writing, software  */
/* distributed under the License is distributed on an "AS IS" BASIS,    */
/* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or      */
/* implied.                                                             */
/* See the License for the specific language governing permissions and  */
/* limitations under the License.                                       */
/************************************************************************/

"use strict";

const DMAppClientLib = require('DMAppClientLib');
const ReconnectingWebSocket = require("reconnectingwebsocket");

const defaultServerUrl = "ws://127.0.0.1:7692";
const defaultAppEndpoint = "eu.2-immerse";

/**
 * @classdesc
 *
 * TV emulator discovery server control and app2app functionality.
 * App2app is not started on construction.
 *
 * @constructor
 * @param {!DMAppController} dMAppController parent controller
 * @param {?Object} options optional options object
 * @param {string} [options.serverUrl=ws://127.0.0.1:7692] override tvemu discovery/app2app server URL
 */
function DMAppTvEmuController(dMAppController, options) {
	const self = this;
	if (!options) options = {};
	Object.defineProperty(self, 'dMAppController', { value: dMAppController });
	Object.defineProperty(self, 'logger',          { value: dMAppController.createNamedLogger("DMAppTvEmuController") });
	Object.defineProperty(self, 'app2appSockets',  { value: new Set() });
	Object.defineProperty(self, 'listenerTracker', { value: new DMAppClientLib.deps.listenerTracker.createTracker() });
	Object.defineProperty(self, '_wsStateOks',     { value: {} });
	Object.defineProperty(self, '_presenceTimers', { value: new Map() });
	this._auxData = null;
	Object.defineProperty(self, '_auxDataMap',     { value: new Map() });

	this.logger.info("DMAppTvEmuController version: " + require('__VERSION__'));

	this._app2appEnabled = false;

	if (DMAppTvEmuController._debugConstructorHooks.length) {
		/* global console */
		console.warn("Executing " + DMAppTvEmuController._debugConstructorHooks.length + " DMAppTvEmuController debug constructor hooks");
		if (!options) options = {};
		for (let i = 0; i &lt; DMAppTvEmuController._debugConstructorHooks.length; i++) {
			DMAppTvEmuController._debugConstructorHooks[i](this, options);
		}
	}

	Object.defineProperty(self, 'serverUrl',       { value: options.serverUrl || defaultServerUrl });

	DMAppClientLib.argCheck(arguments, 2, self.logger, "DMAppTvEmuSync DMAppTvEmuController", options, ['serverUrl', 'disabled']);

	Object.defineProperty(self, 'disabled',        { value: !!options.disabled });
	if (options.disabled) {
		this.logger.warn("Disabled by constructor option");
		return;
	}

	const ws = new ReconnectingWebSocket(self.serverUrl + "/control", [], {
		reconnectInterval: 500,
		reconnectDecay: 2,
		maxReconnectInterval: 30000,
	});
	Object.defineProperty(self, 'ws',              { value: ws });

	self.controlErrorCounter = self.logger.makeFlushableLogEventCounter('error', { autoFlushTimeout: 120000 }, "TV emulator control websocket error(s)");
	self.app2appErrorCounter = self.logger.makeFlushableLogEventCounter('error', { autoFlushTimeout: 120000 }, "App2app websocket error(s)");

	self.wsConnected = false;
	self.ws.addEventListener("open", function() {
		self.logger.info("TV emulator control websocket open");
		self.controlErrorCounter.flush();
		self.wsConnected = true;
		self.ws.send(self.getInstanceIdMsg());
		self.ws.send(self.getDeviceIdMsg());
		self.ws.send(self.getContextIdMsg());
		self.ws.send(self.getInterContextIdMsg());
		self.ws.send(self.getSessionIdMsg());
		for (let [k, v] of self._auxDataMap) {
			if (v != null) self.ws.send(self.getSetAuxDataKeyMsg(k, v));
		}
		self._setWsOkState("Control", true);
	});
	self.ws.addEventListener("close", function() {
		self.logger.error("TV emulator control websocket close");
		self.wsConnected = false;
		self._setWsOkState("Control", false);
	});
	self.ws.addEventListener("error", function() {
		self.controlErrorCounter.event();
		self.wsConnected = false;
		self._setWsOkState("Control", false);
	});
	self.listenerTracker.subscribeTo(self.dMAppController.layout).on("contextChange", function(info) {
		if (self.wsConnected) self.ws.send(self.getContextIdMsg());
		self.app2appBroadcastSend(self.getContextIdMsg());
	});
	self.listenerTracker.subscribeTo(self.dMAppController.layout).on("dmAppChange", function(info) {
		self.app2appBroadcastSend(self.getDmAppIdMsg());
	});
	self.listenerTracker.subscribeTo(self.dMAppController.layout._interCtxIdSignal).on("change", function(info) {
		if (self.wsConnected) self.ws.send(self.getInterContextIdMsg());
		self.app2appBroadcastSend(self.getInterContextIdMsg());
	});
	self.listenerTracker.subscribeTo(self.dMAppController._sessionIdSignal).on("change", function(info) {
		if (self.wsConnected) self.ws.send(self.getSessionIdMsg());
		self.app2appBroadcastSend(self.getSessionIdMsg());
	});
	self.listenerTracker.subscribeTo(self.dMAppController._modeSignal).on("change", function(info) {
		self.app2appBroadcastSend(self.getModeSignalMsg());
	});
	self.listenerTracker.subscribeTo(self.dMAppController.localDevGroupErrorSummary).on("change", function(info) {
		self.app2appBroadcastSend(self.getLocalDevGroupErrorSummarySignalMsg());
	});
	self.listenerTracker.subscribeTo(window).on("beforeunload", function() {
		self.controlErrorCounter.flush();
		self.app2appErrorCounter.flush();
	});
}

DMAppTvEmuController.prototype.getInstanceIdMsg = function() {
	return JSON.stringify({
		type: 'instance',
		value: this.dMAppController.instanceId,
	});
};

DMAppTvEmuController.prototype.getDeviceIdMsg = function() {
	return JSON.stringify({
		type: 'device',
		value: this.dMAppController.getDeviceId(),
	});
};

DMAppTvEmuController.prototype.getContextIdMsg = function() {
	return JSON.stringify({
		type: 'context',
		value: this.dMAppController.layout.contextId,
	});
};

DMAppTvEmuController.prototype.getInterContextIdMsg = function() {
	return JSON.stringify({
		type: 'interContext',
		value: this.dMAppController.layout.interContextId,
	});
};

DMAppTvEmuController.prototype.getSessionIdMsg = function() {
	return JSON.stringify({
		type: 'session',
		value: this.dMAppController.sessionId,
	});
};

DMAppTvEmuController.prototype.getModeSignalMsg = function() {
	return JSON.stringify({
		type: 'setMode',
		value: this.dMAppController._modeSignal.getValue(),
	});
};

DMAppTvEmuController.prototype.getLocalDevGroupErrorSummarySignalMsg = function() {
	return JSON.stringify({
		type: 'localDevGroupErrorSummary',
		value: this.dMAppController.localDevGroupErrorSummary.getValue(),
	});
};

DMAppTvEmuController.prototype.getDmAppIdMsg = function() {
	return JSON.stringify({
		type: 'dmApp',
		value: this.dMAppController.layout.dmAppId,
	});
};

DMAppTvEmuController.prototype.getServiceUrlsMsg = function() {
	return JSON.stringify({
		type: 'serviceUrls',
		value: this.dMAppController._urls,
	});
};

DMAppTvEmuController.prototype.getSetAuxDataMsg = function() {
	return JSON.stringify({
		type: 'setAllAuxData',
		value: this._auxData,
	});
};

DMAppTvEmuController.prototype.getSetAuxDataKeyMsg = function(k, v) {
	return JSON.stringify({
		type: 'setAuxData',
		key: k,
		value: JSON.stringify(v),
	});
};

DMAppTvEmuController.prototype._updateErrorSummary = function(deviceId, instanceId, summary) {
	const state = this.dMAppController.localDevGroupErrorSummary.getValue() || {};
	const key = deviceId + ':' + instanceId;
	if (!summary || !summary.length) {
		delete state[key];
	} else {
		state[key] = summary;
	}
	this.dMAppController.localDevGroupErrorSummary._change(state);
};

DMAppTvEmuController.prototype.setAuxData = function(data) {
	this._auxData = data;
	for (let k of this._auxDataMap.keys()) {
		this._auxDataMap.set(k, undefined);
	}
	if (data) {
		for (let k in data) {
			this._auxDataMap.set(k, data[k]);
		}
	}
	if (this.wsConnected) {
		for (let [k, v] of this._auxDataMap) {
			this.ws.send(this.getSetAuxDataKeyMsg(k, v));
		}
	}
	this.app2appBroadcastSend(this.getSetAuxDataMsg());
};

/**
 * Start app2app functionality if not already started
 * @param {string} [appEndpoint=eu.2-immerse]
 */
DMAppTvEmuController.prototype.startApp2App = function(appEndpoint) {
	if (this.disabled) return;
	if (this._app2appEnabled) return;
	this._app2appEnabled = true;
	this._app2appSetup(appEndpoint || defaultAppEndpoint);
	this.dMAppController.app2appMsgBusCtl.setMaster(true);
	this.dMAppController.app2appMsgBusCtl.setEnabled(true);

	const localErrorSummary = this.dMAppController.getErrorSignalSummarySignal();
	const updateLocal = function() {
		this._updateErrorSummary(this.dMAppController.getDeviceId(), this.dMAppController.instanceId, localErrorSummary.getValue());
	}.bind(this);
	this.listenerTracker.subscribeTo(localErrorSummary).on("change", updateLocal);
};

/** Stop app2app functionality if not already stopped */
DMAppTvEmuController.prototype.stopApp2App = function() {
	if (!this._app2appEnabled) return;
	this._app2appEnabled = false;
	this._setWsOkState("App2app", true);
	if (this._currentApp2App) {
		this._currentApp2App.close();
	}
	for (let sock of this.app2appSockets) {
		sock.close();
	}
	this.dMAppController.app2appMsgBusCtl.setEnabled(false);
	this.listenerTracker.removeAllListeners(this.dMAppController.getErrorSignalSummarySignal());
	this.dMAppController.localDevGroupErrorSummary._change(null);
};

DMAppTvEmuController.prototype._app2appSetup = function(appEndpoint, retryCount) {
	if (!this._app2appEnabled) return;
	if (!retryCount) retryCount = 0;
	const self = this;
	const socket = new WebSocket(this.serverUrl + "/app2app/local/" + appEndpoint);
	this._currentApp2App = socket;
	let paired = false;
	let app2appSync;
	let deviceId = '';
	const signalSubscriptionListenerTracker = DMAppClientLib.deps.listenerTracker.createTracker();
	const activeMergedPerDeviceSignals = new Map();
	const activeMergedPerDeviceRCSignals = new Map();

	const mpdSubscribe = function(msg, activeMap, mergedMap, messageType) {
		for (let i = 0; i &lt; msg.keys.length; i++) {
			const key = msg.keys[i];
			if (activeMap.has(key)) {
				self.logger.warn("Duplicate merged per device signal subscription attempt, ignoring: " + key);
				continue;
			}
			const info = mergedMap.getSignal(key);
			activeMap.set(key, info);
			info.signal.onImmediate("change", function() {
				socket.send(JSON.stringify({
					type: messageType,
					key: key,
					value: info.signal.getValue(),
				}));
			}, signalSubscriptionListenerTracker);
		}
	};

	const mpdUnsubscribe = function(msg, activeMap) {
		for (let i = 0; i &lt; msg.keys.length; i++) {
			const key = msg.keys[i];
			const info = activeMap.get(key);
			if (!info) {
				self.logger.warn("Unexpected merged per device signal unsubscription attempt, ignoring: " + key);
				continue;
			}
			signalSubscriptionListenerTracker.removeAllListeners(info.signal);
			info.unref();
			activeMap.delete(key);
		}
	};

	const processApp2AppMsg = function(msg) {
		try {
			if (msg.type === "device") {
				deviceId = msg.value;
				self.dMAppController.app2appMsgBusCtl.setDeviceIdWebsocket(deviceId, socket);

				const timerId = self._presenceTimers.get(deviceId);
				if (timerId != null) {
					window.clearTimeout(timerId);
					self._presenceTimers.delete(deviceId);
				}
			} else if (msg.type === "instance") {
				const info = self.dMAppController.app2appMsgBusCtl._getSocketMetadata(socket, true);
				info.instanceId = msg.value;
			} else if (msg.type === "remoteAddr") {
				const info = self.dMAppController.app2appMsgBusCtl._getSocketMetadata(socket, true);
				info.remoteAddress = msg.address;
				info.remotePort = msg.port;
			} else if (msg.type === "app2appSyncCtl") {
				if (msg.sync &amp;&amp; !app2appSync) {
					app2appSync = new App2AppSyncServer(self.dMAppController, socket, deviceId);
				} else if (!msg.sync &amp;&amp; app2appSync) {
					app2appSync.destroy();
					app2appSync = null;
				}
			} else if (msg.type === "app2appMsgBus") {
				self.dMAppController.app2appMsgBusCtl.recv(msg);
			} else if (msg.type === "errorSummary") {
				const info = self.dMAppController.app2appMsgBusCtl._getSocketMetadata(socket, true);
				self._updateErrorSummary(deviceId, info.instanceId, msg.value);
			} else if (msg.type === "subscribeSharedSignals") {
				for (let i = 0; i &lt; msg.keys.length; i++) {
					const key = msg.keys[i];
					const signal = self.dMAppController._sharedSignalStorage.getSignal(key);
					signal.onImmediate("change", function() {
						socket.send(JSON.stringify({
							type: 'sharedSignalChange',
							key: key,
							value: signal.getValue(),
						}));
					}, signalSubscriptionListenerTracker);
				}
			} else if (msg.type === "unsubscribeSharedSignals") {
				for (let i = 0; i &lt; msg.keys.length; i++) {
					const signal = self.dMAppController._sharedSignalStorage.getSignal(msg.keys[i]);
					signalSubscriptionListenerTracker.removeAllListeners(signal);
				}
			} else if (msg.type === "subscribeMergedPerDeviceSignals") {
				mpdSubscribe(msg, activeMergedPerDeviceSignals, self.dMAppController._perDeviceSignalMerged, 'mergedPerDeviceSignalChange');
			} else if (msg.type === "subscribeMergedPerDeviceRCSignals") {
				mpdSubscribe(msg, activeMergedPerDeviceRCSignals, self.dMAppController._perDeviceRCSignalMerged, 'mergedPerDeviceRCSignalChange');
			} else if (msg.type === "unsubscribeMergedPerDeviceSignals") {
				mpdUnsubscribe(msg, activeMergedPerDeviceSignals);
			} else if (msg.type === "unsubscribeMergedPerDeviceRCSignals") {
				mpdUnsubscribe(msg, activeMergedPerDeviceRCSignals);
			} else if (msg.type === "setPerDeviceSignal" || msg.type === "setPerDeviceRCSignal") {
				const rc = msg.type === "setPerDeviceRCSignal";
				const perDeviceInfo = self.dMAppController._getPerDeviceSignalInfo(deviceId, rc);
				perDeviceInfo.values.set(msg.key, msg.value);
				self.dMAppController._updateMergedPerDeviceGenericSignal(msg.key, rc);
			} else if (msg.type === "setAllPerDeviceSignals" || msg.type === "setAllPerDeviceRCSignals") {
				const rc = msg.type === "setAllPerDeviceRCSignals";
				const perDeviceInfo = self.dMAppController._getPerDeviceSignalInfo(deviceId, rc);
				const oldValues = perDeviceInfo.values;
				perDeviceInfo.values = new Map();
				for (let i = 0; i &lt; msg.signals.length; i++) {
					const k = msg.signals[i][0];
					const v = msg.signals[i][1];
					oldValues.delete(k);
					perDeviceInfo.values.set(k, v);
					self.dMAppController._updateMergedPerDeviceGenericSignal(k, rc);
				}
				for (let k of oldValues.keys()) self.dMAppController._updateMergedPerDeviceGenericSignal(k, rc);
			} else {
				self.logger.warn("Unexpected message from app2app websocket", msg);
			}
		} catch(e) {
			self.logger.error("Error in handling app2app websocket message; ", e, msg);
		}
	};

	socket.addEventListener("open", function() {
		self._setWsOkState("App2app", true);
		self.app2appErrorCounter.flush();
	});
	socket.addEventListener("message", function(msg) {
		if (!paired &amp;&amp; msg.data === "pairingcompleted") {
			paired = true;
			delete self._currentApp2App;
			self.app2appSockets.add(socket);
			socket.send(self.getInstanceIdMsg());
			socket.send(self.getDeviceIdMsg());
			socket.send(self.getInterContextIdMsg());
			socket.send(self.getSessionIdMsg());
			socket.send(self.getContextIdMsg());
			socket.send(self.getDmAppIdMsg());
			socket.send(self.getServiceUrlsMsg());
			socket.send(self.getSetAuxDataMsg());
			if (self.dMAppController._modeSignal.getValue() !== undefined) {
				socket.send(self.getModeSignalMsg());
			}
			socket.send(self.getLocalDevGroupErrorSummarySignalMsg());
			self._app2appSetup(appEndpoint);
			return;
		}
		try {
			const msg = JSON.parse(event.data);
			if (Array.isArray(msg)) {
				for (let i = 0; i &lt; msg.length; i++) {
					processApp2AppMsg(msg[i]);
				}
			} else {
				processApp2AppMsg(msg);
			}
		} catch(e) {
			self.logger.error("Error in handling app2app websocket message; ", e, event.data);
		}
	});
	const closeSocket = function() {
		signalSubscriptionListenerTracker.removeAllListeners();
		for (let info of activeMergedPerDeviceSignals.values()) {
			info.unref();
		}
		activeMergedPerDeviceSignals.clear();
		for (let info of activeMergedPerDeviceRCSignals.values()) {
			info.unref();
		}
		activeMergedPerDeviceRCSignals.clear();
		if (app2appSync) {
			app2appSync.destroy();
			app2appSync = null;
		}
		self.app2appSockets.delete(socket);
		if (socket === self._currentApp2App) {
			delete self._currentApp2App;
			if (self._app2appEnabled) {
				window.setTimeout(function() {
					self._app2appSetup(appEndpoint, retryCount + 1);
				}, Math.pow(2, Math.min(6, retryCount)) * 500);
			}
		}
		if (deviceId) {
			self.dMAppController.app2appMsgBusCtl.setDeviceIdWebsocket(deviceId, null);
			if (!self._presenceTimers.has(deviceId)) {
				self._presenceTimers.set(deviceId, window.setTimeout(function() {
					self.dMAppController._removePerDeviceSignal(deviceId);
					self._presenceTimers.delete(deviceId);
				}, 5000));
			}
		}
	};
	socket.addEventListener("close", function() {
		closeSocket();
	});
	socket.addEventListener("error", function() {
		closeSocket();
		self.app2appErrorCounter.event();
		self._setWsOkState("App2app", false);
	});
};

/** Broadcast arguments to all app2app sockets */
DMAppTvEmuController.prototype.app2appBroadcastSend = function() {
	const args = [].slice.call(arguments);
	for (let sock of this.app2appSockets) {
		sock.send.apply(sock, args);
	}
};

DMAppTvEmuController.prototype._setWsOkState = function(socketName, ok) {
	if (ok === this._wsStateOks[socketName]) return;
	this._wsStateOks[socketName] = ok;
	const badSockets = [];
	for (let prop in this._wsStateOks) {
		if (!this._wsStateOks[prop]) badSockets.push(prop);
	}
	if (badSockets.length === 0) {
		if (this._wsStateDevLogCtl) this._wsStateDevLogCtl.clear();
		this.dMAppController.errorSignals.localServices.unregisterReference(this);
	} else {
		if (!this._wsStateDevLogCtl) this._wsStateDevLogCtl = this.dMAppController.makeDevLoggingCtl({ single: true });
		this.dMAppController.devDialogLogger.error("Error connecting/using TV emulator " + badSockets.join(", ") + " websocket(s). Check that TV emulator services are operational.", this._wsStateDevLogCtl);
		this.dMAppController.errorSignals.localServices.registerReference(this);
	}
};

DMAppTvEmuController._debugConstructorHooks = [];

/**
 * Destructor, the instance MAY NOT be used after calling this.
 */
DMAppTvEmuController.prototype.destroy = function() {
	this.controlErrorCounter.flush();
	this.app2appErrorCounter.flush();
	this.stopApp2App();
	if (this.ws) this.ws.close();
	this.listenerTracker.removeAllListeners();
};

function App2AppSyncServer(dMAppController, socket, deviceId) {
	Object.defineProperty(this, 'logger',          { value: dMAppController.createNamedLogger("App2AppSyncServer: (" + deviceId + ")") });
	Object.defineProperty(this, 'dMAppController', { value: dMAppController });
	Object.defineProperty(this, 'socket',          { value: socket });
	Object.defineProperty(this, 'deviceId',        { value: deviceId });
	Object.defineProperty(this, 'clock',           { value: dMAppController.timeline.defaultClock });

	this.dMAppController.timeline.synchroniseExternalToClock(this.clock, this);
}

App2AppSyncServer.prototype.changeEvent = function(subtype) {
	this.timerCtl();
	this.sendUpdate(subtype);
};

App2AppSyncServer.prototype.sendUpdate = function(subtype) {
	this.socket.send(JSON.stringify({
		type: "app2appSyncEvent",
		subtype: subtype,
		speed: this.clock.getEffectiveSpeed(),
		time: this.clock.now() / this.clock.getTickRate(),
	}));
};

App2AppSyncServer.prototype.timerCtl = function() {
	const needTimer = this.isSynced &amp;&amp; this.clock.getEffectiveSpeed() !== 0;
	if (needTimer &amp;&amp; this._intervalId == null) {
		this._intervalId = window.setInterval(this.sendUpdate.bind(this, "update"), 2000);
	} else if (!needTimer &amp;&amp; this._intervalId != null) {
		window.clearInterval(this._intervalId);
		delete this._intervalId;
	}
};

App2AppSyncServer.prototype.sync = function(info) {
	this.logger.info("Syncing from clock: " + this.dMAppController.timeline.getClockInfo(this.clock));
	this.isSynced = true;
	this._clockChangeHandler = this.changeEvent.bind(this, "change");
	this.clock.on("change", this._clockChangeHandler);
	this.changeEvent("available");
};

App2AppSyncServer.prototype.unsync = function(info) {
	this.logger.info("Unsyncing from clock: " + this.dMAppController.timeline.getClockInfo(this.clock));
	this.isSynced = false;
	this.timerCtl();
	this.clock.removeListener("change", this._clockChangeHandler);
	delete this._clockChangeHandler;
	if (this.socket.readyState &lt; this.socket.CLOSING) {
		this.socket.send(JSON.stringify({
			type: "app2appSyncEvent",
			subtype: "unavailable",
		}));
	}
};

App2AppSyncServer.prototype.dump = function(info, dumper) {
	const cat = dumper.subcategory("App2AppSync");
	if (this.isSynced) {
		cat.keyValue("sync", "yes");
	} else {
		cat.keyValue("sync", "no");
	}
	cat.keyValue("deviceId", this.deviceId);
};

App2AppSyncServer.prototype.destroy = function() {
	this.dMAppController.timeline.unsynchroniseFromClock(this.clock, this);
};

try {
	Object.freeze(DMAppTvEmuController.prototype);
	Object.freeze(App2AppSyncServer.prototype);
} catch (e) {
	/* swallow: doesn't matter too much if this fails */
}

module.exports = DMAppTvEmuController;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-DMAppAndroid.html">DMAppAndroid</a></li><li><a href="module-DMAppClientLib.html">DMAppClientLib</a></li><li><a href="module-DMAppCompEmuLib.html">DMAppCompEmuLib</a></li><li><a href="module-DMAppCompLib.html">DMAppCompLib</a></li><li><a href="module-DMAppIos.html">DMAppIos</a></li><li><a href="module-DMAppTvEmuLib.html">DMAppTvEmuLib</a></li></ul><h3>Classes</h3><ul><li><a href="AjaxPromise.html">AjaxPromise</a></li><li><a href="App2AppMsgBusCtl.html">App2AppMsgBusCtl</a></li><li><a href="App2AppMsgBusCtl.App2AppMsgBusRecvHandler.html">App2AppMsgBusRecvHandler</a></li><li><a href="BlockableWrapper.html">BlockableWrapper</a></li><li><a href="CiiSyncHandlerBase.html">CiiSyncHandlerBase</a></li><li><a href="ClockArrayIntervalScheduler.html">ClockArrayIntervalScheduler</a></li><li><a href="ComponentContainer.html">ComponentContainer</a></li><li><a href="DebugMiscUtil.SerialisationDumper.html">SerialisationDumper</a></li><li><a href="DeviceOrientationCtl.html">DeviceOrientationCtl</a></li><li><a href="DMAppAndroidCompDiscovery.html">DMAppAndroidCompDiscovery</a></li><li><a href="DMAppAndroidSynchroniser.html">DMAppAndroidSynchroniser</a></li><li><a href="DMAppAVPlayerComponent.html">DMAppAVPlayerComponent</a></li><li><a href="DMAppComp.html">DMAppComp</a></li><li><a href="DMAppCompDiscoveryFilter.html">DMAppCompDiscoveryFilter</a></li><li><a href="DMAppCompEmuDiscovery.html">DMAppCompEmuDiscovery</a></li><li><a href="DMAppComponent.html">DMAppComponent</a></li><li><a href="DMAppComponentWrapper.html">DMAppComponentWrapper</a></li><li><a href="DMAppController.html">DMAppController</a></li><li><a href="DMAppIosCompDiscovery.html">DMAppIosCompDiscovery</a></li><li><a href="DMAppLayout.html">DMAppLayout</a></li><li><a href="DMAppLayoutIO.html">DMAppLayoutIO</a></li><li><a href="DMAppLayoutRegionCtl.html">DMAppLayoutRegionCtl</a></li><li><a href="DMAppTimeline.html">DMAppTimeline</a></li><li><a href="DMAppTvEmuController.html">DMAppTvEmuController</a></li><li><a href="DMAppTvEmuSync.html">DMAppTvEmuSync</a></li><li><a href="ErrorUtil.ErrorFlag.html">ErrorFlag</a></li><li><a href="ErrorUtil.ErrorSignal.html">ErrorSignal</a></li><li><a href="ExecValve.html">ExecValve</a></li><li><a href="InputDocument.InputDocumentHandler.html">InputDocumentHandler</a></li><li><a href="KeyStore.html">KeyStore</a></li><li><a href="LocalSignalMap.html">LocalSignalMap</a></li><li><a href="Logger.html">Logger</a></li><li><a href="MediaElementClockSource.html">MediaElementClockSource</a></li><li><a href="MediaSynchroniser.html">MediaSynchroniser</a></li><li><a href="PromiseExecQueue.html">PromiseExecQueue</a></li><li><a href="RefCountedSignalMap.html">RefCountedSignalMap</a></li><li><a href="ResourceMgmtUtil.RefCountedDelayedDestructor.html">RefCountedDelayedDestructor</a></li><li><a href="Signal.BaseSignal.html">BaseSignal</a></li><li><a href="Signal.BlockCountSignal.html">BlockCountSignal</a></li><li><a href="Signal.ConstWrapperSignal.html">ConstWrapperSignal</a></li><li><a href="Signal.RefCountSignal.html">RefCountSignal</a></li><li><a href="Signal.SettableSignal.html">SettableSignal</a></li><li><a href="Signal.SharedStatePropertySignal.html">SharedStatePropertySignal</a></li><li><a href="StateMapping.ContextGlobalSharedStateMapping.html">ContextGlobalSharedStateMapping</a></li><li><a href="StateMapping.ContextGroupParameterSharedStateMapping.html">ContextGroupParameterSharedStateMapping</a></li><li><a href="StateMapping.SharedStateMappingBase.html">SharedStateMappingBase</a></li><li><a href="StateMapping.StaticPathSharedStateMapping.html">StaticPathSharedStateMapping</a></li><li><a href="StickyClockCorrelationSource.html">StickyClockCorrelationSource</a></li><li><a href="SyncProtocolsCiiSyncHandler.html">SyncProtocolsCiiSyncHandler</a></li><li><a href="TestConfigTestComponent.html">TestConfigTestComponent</a></li><li><a href="TimeoutHandler.html">TimeoutHandler</a></li><li><a href="VersionUtil.FeatureVersionSet.html">FeatureVersionSet</a></li></ul><h3>Events</h3><ul><li><a href="AjaxPromise.html#event:fail">fail</a></li><li><a href="AjaxPromise.html#event:retry">retry</a></li><li><a href="AjaxPromise.html#event:success">success</a></li><li><a href="App2AppMsgBusCtl.html#event:deviceSocketChange">deviceSocketChange</a></li><li><a href="App2AppMsgBusCtl.html#event:enabledStateChange">enabledStateChange</a></li><li><a href="App2AppMsgBusCtl.html#event:upstreamChange">upstreamChange</a></li><li><a href="ClockArrayIntervalScheduler.html#event:change">change</a></li><li><a href="ComponentContainer.html#event:createdComponent">createdComponent</a></li><li><a href="ComponentContainer.html#event:destroyedComponent">destroyedComponent</a></li><li><a href="ComponentContainer.html#event:destroyingComponent">destroyingComponent</a></li><li><a href="DiscoveryCtl.html#event:destroy">destroy</a></li><li><a href="DiscoveryCtl.html#event:newDevice">newDevice</a></li><li><a href="DiscoveryCtl.html#event:removeDevice">removeDevice</a></li><li><a href="DiscoveryCtl.html#event:updateDevice">updateDevice</a></li><li><a href="DMAppAndroidCompDiscovery.html#event:newDevice">newDevice</a></li><li><a href="DMAppAndroidCompDiscovery.html#event:removeDevice">removeDevice</a></li><li><a href="DMAppAndroidCompDiscovery.html#event:updateDevice">updateDevice</a></li><li><a href="DMAppAVPlayerComponent.html#event:componentInfoUpdate">componentInfoUpdate</a></li><li><a href="DMAppAVPlayerComponent.html#event:destroy">destroy</a></li><li><a href="DMAppAVPlayerComponent.html#event:dMAppComponentStatusChange">dMAppComponentStatusChange</a></li><li><a href="DMAppAVPlayerComponent.html#event:dMAppComponentStatusDurationChange">dMAppComponentStatusDurationChange</a></li><li><a href="DMAppAVPlayerComponent.html#event:elementAttached">elementAttached</a></li><li><a href="DMAppAVPlayerComponent.html#event:elementDetached">elementDetached</a></li><li><a href="DMAppAVPlayerComponent.html#event:isRunningChange">isRunningChange</a></li><li><a href="DMAppAVPlayerComponent.html#event:referenceClockChange">referenceClockChange</a></li><li><a href="DMAppAVPlayerComponent.html#event:runningStateChange">runningStateChange</a></li><li><a href="DMAppAVPlayerComponent.html#event:startStopTimeChange">startStopTimeChange</a></li><li><a href="DMAppAVPlayerComponent.html#event:startTimeChange">startTimeChange</a></li><li><a href="DMAppAVPlayerComponent.html#event:stopTimeChange">stopTimeChange</a></li><li><a href="DMAppAVPlayerComponent.html#event:visibilityChange">visibilityChange</a></li><li><a href="DMAppComp.html#event:join">join</a></li><li><a href="DMAppComp.html#event:remoteDeviceIdChange">remoteDeviceIdChange</a></li><li><a href="DMAppComp.html#event:remoteJoinStateChange">remoteJoinStateChange</a></li><li><a href="DMAppCompEmuDiscovery.html#event:newDevice">newDevice</a></li><li><a href="DMAppCompEmuDiscovery.html#event:removeDevice">removeDevice</a></li><li><a href="DMAppCompEmuDiscovery.html#event:updateDevice">updateDevice</a></li><li><a href="DMAppComponent.html#event:componentInfoUpdate">componentInfoUpdate</a></li><li><a href="DMAppComponent.html#event:destroy">destroy</a></li><li><a href="DMAppComponent.html#event:dMAppComponentStatusChange">dMAppComponentStatusChange</a></li><li><a href="DMAppComponent.html#event:dMAppComponentStatusDurationChange">dMAppComponentStatusDurationChange</a></li><li><a href="DMAppComponent.html#event:elementAttached">elementAttached</a></li><li><a href="DMAppComponent.html#event:elementDetached">elementDetached</a></li><li><a href="DMAppComponent.html#event:isRunningChange">isRunningChange</a></li><li><a href="DMAppComponent.html#event:referenceClockChange">referenceClockChange</a></li><li><a href="DMAppComponent.html#event:runningStateChange">runningStateChange</a></li><li><a href="DMAppComponent.html#event:startStopTimeChange">startStopTimeChange</a></li><li><a href="DMAppComponent.html#event:startTimeChange">startTimeChange</a></li><li><a href="DMAppComponent.html#event:stopTimeChange">stopTimeChange</a></li><li><a href="DMAppComponent.html#event:visibilityChange">visibilityChange</a></li><li><a href="DMAppController.html#event:logRingBufferUpdate">logRingBufferUpdate</a></li><li><a href="DMAppIosCompDiscovery.html#event:newDevice">newDevice</a></li><li><a href="DMAppIosCompDiscovery.html#event:removeDevice">removeDevice</a></li><li><a href="DMAppIosCompDiscovery.html#event:updateDevice">updateDevice</a></li><li><a href="DMAppLayout.html#event:contextChange">contextChange</a></li><li><a href="DMAppLayout.html#event:createdComponent">createdComponent</a></li><li><a href="DMAppLayout.html#event:destroyedComponent">destroyedComponent</a></li><li><a href="DMAppLayout.html#event:destroyingComponent">destroyingComponent</a></li><li><a href="DMAppLayout.html#event:dmAppChange">dmAppChange</a></li><li><a href="DMAppLayout.html#event:orientationChange">orientationChange</a></li><li><a href="DMAppLayoutRegionCtl.html#event:layoutRegionChange">layoutRegionChange</a></li><li><a href="DMAppTimeline.html#event:interContextSyncIdChange">interContextSyncIdChange</a></li><li><a href="ErrorUtil.ErrorFlag.html#event:change">change</a></li><li><a href="ErrorUtil.ErrorFlag.html#event:fall">fall</a></li><li><a href="ErrorUtil.ErrorFlag.html#event:rise">rise</a></li><li><a href="ErrorUtil.ErrorFlag.html#event:toggle">toggle</a></li><li><a href="ErrorUtil.ErrorSignal.html#event:change">change</a></li><li><a href="ErrorUtil.ErrorSignal.html#event:fall">fall</a></li><li><a href="ErrorUtil.ErrorSignal.html#event:rise">rise</a></li><li><a href="ErrorUtil.ErrorSignal.html#event:toggle">toggle</a></li><li><a href="RefCountedSignalMap.html#event:newSignal">newSignal</a></li><li><a href="RefCountedSignalMap.html#event:removeSignal">removeSignal</a></li><li><a href="Signal.BaseSignal.html#event:change">change</a></li><li><a href="Signal.BaseSignal.html#event:fall">fall</a></li><li><a href="Signal.BaseSignal.html#event:rise">rise</a></li><li><a href="Signal.BaseSignal.html#event:toggle">toggle</a></li><li><a href="Signal.BlockCountSignal.html#event:change">change</a></li><li><a href="Signal.BlockCountSignal.html#event:fall">fall</a></li><li><a href="Signal.BlockCountSignal.html#event:rise">rise</a></li><li><a href="Signal.BlockCountSignal.html#event:toggle">toggle</a></li><li><a href="Signal.ConstWrapperSignal.html#event:change">change</a></li><li><a href="Signal.ConstWrapperSignal.html#event:fall">fall</a></li><li><a href="Signal.ConstWrapperSignal.html#event:rise">rise</a></li><li><a href="Signal.ConstWrapperSignal.html#event:toggle">toggle</a></li><li><a href="Signal.RefCountSignal.html#event:change">change</a></li><li><a href="Signal.RefCountSignal.html#event:fall">fall</a></li><li><a href="Signal.RefCountSignal.html#event:rise">rise</a></li><li><a href="Signal.RefCountSignal.html#event:toggle">toggle</a></li><li><a href="Signal.SettableSignal.html#event:change">change</a></li><li><a href="Signal.SettableSignal.html#event:fall">fall</a></li><li><a href="Signal.SettableSignal.html#event:rise">rise</a></li><li><a href="Signal.SettableSignal.html#event:toggle">toggle</a></li><li><a href="Signal.SharedStatePropertySignal.html#event:change">change</a></li><li><a href="Signal.SharedStatePropertySignal.html#event:fall">fall</a></li><li><a href="Signal.SharedStatePropertySignal.html#event:rise">rise</a></li><li><a href="Signal.SharedStatePropertySignal.html#event:toggle">toggle</a></li></ul><h3>Namespaces</h3><ul><li><a href="ClockMiscUtil.html">ClockMiscUtil</a></li><li><a href="ClockSyncUtil.html">ClockSyncUtil</a></li><li><a href="CustomElementUtil.html">CustomElementUtil</a></li><li><a href="DebugMiscUtil.html">DebugMiscUtil</a></li><li><a href="DMAppTimeline.SharedStateSyncUtil.html">SharedStateSyncUtil</a></li><li><a href="EnumUtil.html">EnumUtil</a></li><li><a href="ErrorUtil.html">ErrorUtil</a></li><li><a href="InputDocument.html">InputDocument</a></li><li><a href="InputUtil.html">InputUtil</a></li><li><a href="MiscUtil.html">MiscUtil</a></li><li><a href="ModuleUtil.html">ModuleUtil</a></li><li><a href="PromiseUtil.html">PromiseUtil</a></li><li><a href="ResourceMgmtUtil.html">ResourceMgmtUtil</a></li><li><a href="Signal.html">Signal</a></li><li><a href="StateMapping.html">StateMapping</a></li><li><a href="TestComponents.html">TestComponents</a></li><li><a href="UpdateUtil.html">UpdateUtil</a></li><li><a href="VersionUtil.html">VersionUtil</a></li></ul><h3>Mixins</h3><ul><li><a href="DMAppAVPlayerComponentBehaviour.html">DMAppAVPlayerComponentBehaviour</a></li><li><a href="DMAppComponentBehaviour.html">DMAppComponentBehaviour</a></li><li><a href="ErrorUtil.ErrorMixin.html">ErrorMixin</a></li></ul><h3>Interfaces</h3><ul><li><a href="Blockable.html">Blockable</a></li><li><a href="CiiSyncHandler.html">CiiSyncHandler</a></li><li><a href="DebugMiscUtil.DebugDumpable.html">DebugDumpable</a></li><li><a href="DebugMiscUtil.DebugDumper.html">DebugDumper</a></li><li><a href="DebugMiscUtil.SerialisationDumper-Dynhandler.html">Dynhandler</a></li><li><a href="DiscoveryCtl.html">DiscoveryCtl</a></li><li><a href="ExternalSync.html">ExternalSync</a></li><li><a href="InputDocument.SetupComponentInterface.html">SetupComponentInterface</a></li></ul><h3>Global</h3><ul><li><a href="global.html#argCheck">argCheck</a></li><li><a href="global.html#retryPromise">retryPromise</a></li><li><a href="global.html#waitable">waitable</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Mar 07 2019 11:17:00 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
